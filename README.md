# Native DOT libs in React Native

This repository contains a basic example on how to use DOT kit (iOS/Android) in React Native (javascript).

## Android

### Java side

We use a source code from `com.innovatrics.android.dot.sample@2.12.0` (found in `android/app/src/main/java/com/innovatrics/android/dot/sample`). It's inlined in this repository. Final React Native app shares the same package name, as the `iFace` uses this name for license check (same as hardware id on desktop).

Documented code responsible for bridge between the native and javascript code can be found in:

- `ActivityStarterModule.java` - A native module is a Java class that usually extends the ReactContextBaseJavaModule class and implements the functionality required by the JavaScript. Most methods (annotated by `@ReactModule`) are callable from javascript and are responsible for starting activities and retrieving data from them.
- `ActivityStarterReactPackage.java` - Apps package that extends `ReactPackage` and uses `createNativeModules` to register a native module
- `MainApplication.java` - We have to provide the package to `getPackages` method of the `MainApplication` - this is pre-existing file/class created by react-native

Inspiration for this approach can be found here: https://github.com/petterh/react-native-android-activity. More information about native modules here: https://facebook.github.io/react-native/docs/native-modules-android.

## iOS

You will need a `iFace` license to run the application.
We use `com.innovatrics.reactnative` as Bundle name (it's used for `iFace` license check).

### Swift/Objective-C side

There is no direct way to use Swift out of the box in React Native, as a bridge between native code and javascript is available only in Objective-C. We first expose swift methods to objective-c (`@objc`) then we expose objective-c methods to javascript (`RCT_EXTERN_MODULE` / `RCT_EXTERN_METHOD`).

Source code is located in `ios` folder.

Documented code responsible for bridge between the native and javascript code can be found in:

- `ActivityStarter.swift` - Swift class responsible for presenting DOT `UIViewController`s - very similar to Android's `ActivityStarterModule` (we have annotate methods we want to use in javascript with `@objc`)
- `ActivityStarter.m` - we have to use Objective-C in React Native - this responsible for exposing Swift methods to javascript (using `RCT_EXTERN_MODULE` and `RCT_EXTERN_METHOD` macros)
- `DotReactNative-Bridging-Header.m` - autogenerated file (by XCode & RN)

More information can be found here: https://facebook.github.io/react-native/docs/native-modules-ios.

## Javascript side

We can use `ActivityStarter` class found in `NativeModules` exported from `react-native`. It will call native code for the corresponding platform (iOS/Android).

Code can be found in `App.js` (root of the repo).

Example:

```javascript
import { NativeModules } from 'react-native';

const activityStarter = NativeModules.ActivityStarter;

// Initialize DOT library
activityStarter
  .initDot()
  .then(...)
  .catch(...);

...
...

// Call Liveness check function
async getLivenessData() {
  const { score, photoUri } = await NativeModules.ActivityStarter.startLivenessCheckActivity();
};
```
